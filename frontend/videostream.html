<!-- Following this tutorial: https://developer.mozilla.org/en-US/docs/Web/API/HTMLVideoElement/requestVideoFrameCallback -->
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width">
  <link rel="stylesheet" href="/src/styles/style.css" />
  <link
    href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:ital,wght@0,100..700;1,100..700&family=Inter:wght@100..900&display=swap"
    rel="stylesheet">
  <script>
    var scriptElm = document.createElement('script');
    scriptElm.defer = true; // Use .defer for the defer attribute
    scriptElm.src = 'http://' + window.location.hostname + ':8889/mystream/reader.js';
    document.head.appendChild(scriptElm);
  </script>
  <script type="module" src="/src/scripts/videostream.ts" defer></script>
</head>

<body>
  <div id="overlay"></div>
  <div id="preparePopup">
    <div class="prepare-header">
      <h2>Prepare Path</h2>
      <button id="prepareCloseBtn">
        <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18M6 6L18 18" stroke="#E0F2E0" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round" />
        </svg>
      </button>
    </div>
    <div class="prepare-body">
      <div id="bottomButtons">
        <button id="prepareCancelBtn" class="action-btn action-btn-cancel">
          <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M8 0C3.589 0 0 3.589 0 8C0 12.411 3.589 16 8 16C12.411 16 16 12.411 16 8C16 3.589 12.411 0 8 0ZM3 8C3 7.168 3.224 6.396 3.584 5.705L10.295 12.416C9.58866 12.7939 8.80103 12.9943 8 13C5.243 13 3 10.757 3 8ZM12.416 10.295L5.705 3.584C6.41134 3.20614 7.19897 3.00571 8 3C10.757 3 13 5.243 13 8C13 8.832 12.776 9.604 12.416 10.295Z"
              />
          </svg>
          <span class="btn-text">CANCEL</span>
        </button>

        <button id="executeBtn" class="action-btn action-btn-execute" data-state="ready">
          <span class="btn-icon">
            <svg width="20" height="20" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
              <path
                d="M10 0C15.523 0 20 4.477 20 10C20 15.523 15.523 20 10 20C4.477 20 0 15.523 0 10C0 4.477 4.477 0 10 0ZM10 13C9.73478 13 9.48043 13.1054 9.29289 13.2929C9.10536 13.4804 9 13.7348 9 14C9 14.2652 9.10536 14.5196 9.29289 14.7071C9.48043 14.8946 9.73478 15 10 15C10.2652 15 10.5196 14.8946 10.7071 14.7071C10.8946 14.5196 11 14.2652 11 14C11 13.7348 10.8946 13.4804 10.7071 13.2929C10.5196 13.1054 10.2652 13 10 13ZM10 4C9.75507 4.00003 9.51866 4.08996 9.33563 4.25272C9.15259 4.41547 9.03566 4.63975 9.007 4.883L9 5V11C9.00028 11.2549 9.09788 11.5 9.27285 11.6854C9.44782 11.8707 9.68695 11.9822 9.94139 11.9972C10.1958 12.0121 10.4464 11.9293 10.6418 11.7657C10.8373 11.6021 10.9629 11.3701 10.993 11.117L11 11V5C11 4.73478 10.8946 4.48043 10.7071 4.29289C10.5196 4.10536 10.2652 4 10 4Z" />
            </svg>
          </span>
          <span class="btn-text">EXECUTE</span>
        </button>
      </div>
    </div>
  </div>
  <div id="settingsPopup">
    <div class="settings-header">
      <h2>Settings</h2>
      <button id="settingsCloseBtn">
        <svg width="24" height="24" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18M6 6L18 18" stroke="#E0F2E0" stroke-width="2" stroke-linecap="round"
            stroke-linejoin="round" />
        </svg>
      </button>
    </div>
    <div class="settings-body">
      <div class="settings-sidebar">
        <button class="sidebar-btn active" data-target="general-settings">General</button>
        <button class="sidebar-btn" data-target="robot-settings">Robot</button>
        <button class="sidebar-btn" data-target="camera-settings">Camera</button>
        <button class="sidebar-btn" data-target="laser-settings">Laser</button>
      </div>
      <div class="settings-main">
        <div id="general-settings" class="settings-panel active">
          <h3>General Settings</h3>
          <div class="setting-item">
            <span class="setting-label">Processing Mode</span>
            <div class="switch-container">
              <span class="switch-label">Batch</span>
              <label class="toggle-switch">
                <input type="checkbox" id="processing-mode">
                <span class="slider round"></span>
              </label>
              <span class="switch-label">Real-Time</span>
            </div>
          </div>
        </div>
        <div id="robot-settings" class="settings-panel">
          <h3>Robot Settings</h3>
        </div>
        <div id="camera-settings" class="settings-panel">
          <h3>Camera Settings</h3>
        </div>
        <div id="laser-settings" class="settings-panel">
          <h3>Laser Settings</h3>
        </div>
      </div>
    </div>
  </div>
  <div id="top-panel">
    <div id="laser-toggle-container">
      <div id="laser-off-bg" class="laser-bg-section"></div>
      <div id="laser-on-bg" class="laser-bg-section"></div>
      <div id="laser-center-box">
        <div id="laser-slider"></div>
        <span id="laser-text">LASER</span>
      </div>
      <span id="laser-off-text">OFF</span>
      <span id="laser-on-text">ON</span>
    </div>
    <div id="status-panel-left" class="status-message">
      <button id="drawBtn" class="action-btn" data-state="ready">
        <span class="btn-icon">
          <svg width="16" height="16" viewBox="0 0 16 16" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M11.0273 0.6625L9.62418 2.06562L13.9336 6.375L15.3367 4.97188C15.7617 4.55 15.9992 3.975 15.9992 3.375C15.9992 2.775 15.7617 2.2 15.3367 1.77813L14.2211 0.6625C13.7992 0.2375 13.2242 0 12.6242 0C12.0242 0 11.4492 0.2375 11.0273 0.6625ZM8.56481 3.125L1.83981 9.84688C1.50543 10.1813 1.26168 10.6 1.13356 11.0562L0.0273051 15.05C-0.0445699 15.3094 0.0273051 15.5906 0.221055 15.7812C0.414805 15.9719 0.69293 16.0469 0.952305 15.975L4.94605 14.8656C5.4023 14.7375 5.81793 14.4969 6.15543 14.1594L12.8742 7.43437L8.56481 3.125Z" />
          </svg>
        </span>
        <span class="btn-text">DRAW PATH</span>
      </button>
      <button id="prepareBtn" class="action-btn action-btn-prepare" disabled>
        <svg width="20" height="12" viewBox="0 0 20 12" xmlns="http://www.w3.org/2000/svg">
          <path
            d="M1 12C0.716667 12 0.479333 11.904 0.288 11.712C0.0966668 11.52 0.000666667 11.2827 0 11V1C0 0.71667 0.0960001 0.479337 0.288 0.288004C0.48 0.0966702 0.717333 0.000670115 1 3.44827e-06C1.28267 -0.000663218 1.52033 0.0953369 1.713 0.288004C1.90567 0.48067 2.00133 0.718003 2 1V11C2 11.2833 1.904 11.521 1.712 11.713C1.52 11.905 1.28267 12.0007 1 12ZM16.175 7H5C4.71667 7 4.47933 6.904 4.288 6.712C4.09667 6.52 4.00067 6.28267 4 6C3.99933 5.71734 4.09533 5.48 4.288 5.288C4.48067 5.096 4.718 5 5 5H16.175L13.3 2.1C13.1167 1.91667 13.0207 1.68767 13.012 1.413C13.0033 1.13834 13.0993 0.90067 13.3 0.700003C13.4833 0.51667 13.7167 0.425004 14 0.425004C14.2833 0.425004 14.5167 0.51667 14.7 0.700003L19.3 5.3C19.4 5.4 19.471 5.50834 19.513 5.625C19.555 5.74167 19.5757 5.86667 19.575 6C19.5743 6.13334 19.5537 6.25834 19.513 6.375C19.4723 6.49167 19.4013 6.6 19.3 6.7L14.7 11.3C14.5167 11.4833 14.2877 11.575 14.013 11.575C13.7383 11.575 13.5007 11.4833 13.3 11.3C13.1 11.1 13 10.8627 13 10.588C13 10.3133 13.1 10.0757 13.3 9.875L16.175 7Z" />
        </svg>
        <span class="btn-text">PREPARE PATH</span>
      </button>
    </div>
    <div id="status-panel-right" class="status-message">
      <span class="status-label">LASER:</span>
      <span class="status-value status-off">OFF</span>
      <span class="status-label">ROBOT:</span>
      <span class="status-value status-off">OFF</span>

      <span class="status-label">CONTROL:</span>
      <span class="status-value status-batch">BATCH</span>
      <span class="status-label">CAMERA:</span>
      <span class="status-value status-camera-off">OFF</span>
    </div>

    <div id="robot-toggle-container">
      <div id="robot-off-bg" class="robot-bg-section"></div>
      <div id="robot-on-bg" class="robot-bg-section"></div>
      <div id="robot-center-box">
        <div id="robot-slider"></div>
        <span id="robot-text">ROBOT</span>
      </div>
      <span id="robot-off-text">OFF</span>
      <span id="robot-on-text">ON</span>
    </div>
  </div>
  <div id="left-panel">

    <div id="top-icon-section">
    </div>

    <div id="main-section-wrapper">
      <div id="middle-icon-section">
        <button id="penBtn" class="icon-btn icon-btn-fill">
          <svg width="26" height="26" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M0.0879274 2.82755C-0.389565 1.15501 1.15613 -0.389531 2.82859 0.087985L14.0977 3.30753C17.7847 4.36102 20.4281 7.33319 20.4281 11.2887C20.4281 11.8917 20.3568 12.4825 20.2263 13.0572C20.1746 13.2849 20.2411 13.4584 20.3285 13.5458L23.3509 16.5685C23.5567 16.7742 23.7199 17.0184 23.8313 17.2872C23.9427 17.556 24 17.8442 24 18.1351C24 18.4261 23.9427 18.7142 23.8313 18.9831C23.7199 19.2519 23.5567 19.4961 23.3509 19.7018L19.7021 23.3509C19.4963 23.5567 19.2521 23.7199 18.9833 23.8313C18.7145 23.9427 18.4264 24 18.1354 24C17.8445 24 17.5564 23.9427 17.2876 23.8313C17.0188 23.7199 16.7745 23.5567 16.5688 23.3509L13.5414 20.3234C13.4553 20.236 13.2805 20.1695 13.0528 20.2224C12.4746 20.3572 11.883 20.4261 11.2893 20.428C7.334 20.428 4.36075 17.7844 3.30854 14.0972L0.0879274 2.82755ZM5.97044 5.96833C5.88467 6.05405 5.81663 6.15583 5.77021 6.26785C5.72379 6.37988 5.6999 6.49996 5.6999 6.62122C5.6999 6.74248 5.72379 6.86256 5.77021 6.97459C5.81663 7.08661 5.88467 7.18839 5.97044 7.27411L9.66855 10.9736C9.84255 11.1419 10.0757 11.235 10.3177 11.233C10.5597 11.231 10.7912 11.1341 10.9624 10.963C11.1336 10.7919 11.2308 10.5605 11.233 10.3185C11.2352 10.0764 11.1423 9.84324 10.9743 9.66908L7.27493 5.9671C7.10187 5.79424 6.86728 5.69715 6.62269 5.69715C6.3781 5.69715 6.1435 5.79547 5.97044 5.96833Z" />
          </svg>
        </button>
        <button id="squareBtn" class="icon-btn icon-btn-stroke">
          <svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M21.9444 1.5H4.05556C2.64416 1.5 1.5 2.64416 1.5 4.05556V21.9444C1.5 23.3558 2.64416 24.5 4.05556 24.5H21.9444C23.3558 24.5 24.5 23.3558 24.5 21.9444V4.05556C24.5 2.64416 23.3558 1.5 21.9444 1.5Z"
              stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
        </button>
        <button id="circleBtn" class="icon-btn icon-btn-fill">
          <svg width="25" height="25" viewBox="0 0 25 25" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M12.5 25C10.7708 25 9.14583 24.6717 7.625 24.015C6.10416 23.3583 4.78125 22.4679 3.65625 21.3437C2.53125 20.2196 1.64083 18.8967 0.985001 17.375C0.329168 15.8533 0.000834915 14.2283 1.58228e-06 12.5C-0.000831751 10.7717 0.327501 9.14666 0.985001 7.625C1.6425 6.10333 2.53292 4.78042 3.65625 3.65625C4.77958 2.53208 6.1025 1.64167 7.625 0.985C9.1475 0.328333 10.7725 0 12.5 0C14.2275 0 15.8525 0.328333 17.375 0.985C18.8975 1.64167 20.2204 2.53208 21.3437 3.65625C22.4671 4.78042 23.3579 6.10333 24.0162 7.625C24.6746 9.14666 25.0025 10.7717 25 12.5C24.9975 14.2283 24.6692 15.8533 24.015 17.375C23.3608 18.8967 22.4704 20.2196 21.3437 21.3437C20.2171 22.4679 18.8942 23.3587 17.375 24.0162C15.8558 24.6737 14.2308 25.0017 12.5 25ZM12.5 22.5C15.2917 22.5 17.6562 21.5312 19.5937 19.5937C21.5312 17.6562 22.5 15.2917 22.5 12.5C22.5 9.70833 21.5312 7.34375 19.5937 5.40625C17.6562 3.46875 15.2917 2.5 12.5 2.5C9.70833 2.5 7.34375 3.46875 5.40625 5.40625C3.46875 7.34375 2.5 9.70833 2.5 12.5C2.5 15.2917 3.46875 17.6562 5.40625 19.5937C7.34375 21.5312 9.70833 22.5 12.5 22.5Z" />
          </svg>
        </button>
        <button id="triangleBtn" class="icon-btn icon-btn-stroke">
          <svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M13 1.5L1.5 24.5H24.5L13 1.5Z" stroke-width="3" stroke-linejoin="round" />
          </svg>
        </button>
        <button id="lineBtn" class="icon-btn icon-btn-stroke">
          <svg width="26" height="26" viewBox="0 0 26 26" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M1.5 24.5L24.5 1.5" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" />
          </svg>
        </button>
      </div>

      <div id="settings-icon-section">
        <button id="settingsBtn" class="icon-btn">
          <svg width="33" height="33" viewBox="0 0 33 33" xmlns="http://www.w3.org/2000/svg">
            <path
              d="M14.4635 33C13.6836 33 13.0122 32.7525 12.4495 32.2575C11.8868 31.7625 11.5471 31.1575 11.4304 30.4425L11.0404 27.72C10.6649 27.5825 10.3113 27.4175 9.97973 27.225C9.64811 27.0325 9.32285 26.8263 9.00394 26.6062L6.31749 27.6787C5.59533 27.9812 4.87316 28.0088 4.151 27.7613C3.42883 27.5138 2.86555 27.0737 2.46113 26.4412L0.424632 23.0588C0.0202203 22.4263 -0.0953256 21.7525 0.0779938 21.0375C0.251313 20.3225 0.641281 19.7313 1.2479 19.2638L3.54438 17.6138C3.51549 17.4212 3.50105 17.2353 3.50105 17.056V15.9423C3.50105 15.7641 3.51549 15.5787 3.54438 15.3862L1.2479 13.7362C0.641281 13.2687 0.251313 12.6775 0.0779938 11.9625C-0.0953256 11.2475 0.0202203 10.5737 0.424632 9.94125L2.46113 6.55875C2.86555 5.92625 3.42883 5.48625 4.151 5.23875C4.87316 4.99125 5.59533 5.01875 6.31749 5.32125L9.00394 6.39375C9.32169 6.17375 9.65389 5.9675 10.0005 5.775C10.3472 5.5825 10.6938 5.4175 11.0404 5.28L11.4304 2.5575C11.546 1.8425 11.8857 1.2375 12.4495 0.7425C13.0134 0.2475 13.6847 0 14.4635 0H18.5365C19.3164 0 19.9883 0.2475 20.5522 0.7425C21.1161 1.2375 21.4552 1.8425 21.5696 2.5575L21.9596 5.28C22.3351 5.4175 22.6892 5.5825 23.022 5.775C23.3548 5.9675 23.6795 6.17375 23.9961 6.39375L26.6825 5.32125C27.4047 5.01875 28.1268 4.99125 28.849 5.23875C29.5712 5.48625 30.1345 5.92625 30.5389 6.55875L32.5754 9.94125C32.9798 10.5737 33.0953 11.2475 32.922 11.9625C32.7487 12.6775 32.3587 13.2687 31.7521 13.7362L29.4556 15.3862C29.4845 15.5787 29.4989 15.7647 29.4989 15.9439V17.056C29.4989 17.2353 29.4701 17.4212 29.4123 17.6138L31.7088 19.2638C32.3154 19.7313 32.7054 20.3225 32.8787 21.0375C33.052 21.7525 32.9364 22.4263 32.532 23.0588L30.4522 26.4412C30.0478 27.0737 29.4845 27.5138 28.7623 27.7613C28.0402 28.0088 27.318 27.9812 26.5958 27.6787L23.9961 26.6062C23.6783 26.8263 23.3461 27.0325 22.9995 27.225C22.6528 27.4175 22.3062 27.5825 21.9596 27.72L21.5696 30.4425C21.454 31.1575 21.1149 31.7625 20.5522 32.2575C19.9895 32.7525 19.3176 33 18.5365 33H14.4635ZM16.5867 22.275C18.2621 22.275 19.692 21.7113 20.8763 20.5837C22.0607 19.4563 22.6528 18.095 22.6528 16.5C22.6528 14.905 22.0607 13.5437 20.8763 12.4162C19.692 11.2887 18.2621 10.725 16.5867 10.725C14.8824 10.725 13.445 11.2887 12.2745 12.4162C11.104 13.5437 10.5193 14.905 10.5205 16.5C10.5216 18.095 11.1069 19.4563 12.2762 20.5837C13.4455 21.7113 14.8824 22.275 16.5867 22.275Z" />
          </svg>
        </button>
      </div>
    </div>
  </div>
  <canvas id="canvas"></canvas>
  <video id="video"></video>
</body>

</html>